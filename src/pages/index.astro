---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const getAllCollectionEntries = (collectionName) => {
  return getCollection(collectionName);
}

const getAllLinks = async () => {
  return await getAllCollectionEntries('links').then((links) =>
    links.filter((entry) => entry.id.startsWith('es-'))
  );
};
const getAllPosts = async () => {
  return await getAllCollectionEntries('posts').then((posts) =>
    posts.filter((entry) => entry.id.startsWith('es-'))
  )
};

const links = await getAllLinks();
const posts = await getAllPosts();

const contents = [...posts, ...links];

const tagsCount = {};
contents.forEach((content) => {
  content.data.tags.forEach((tag) => {
    if (!tagsCount[tag]) tagsCount[tag] = new Set();
    tagsCount[tag].add(content.id);
  });
});

const tags = Object.keys(tagsCount).sort((a,b) => tagsCount[b].size - tagsCount[a].size);
---

<BaseLayout lang="es" slug="/">
  <div class="grid gap-4 mt-4">
    <div class="grid gap-2">
      <h2 class="text-2xl font-bold">Latest Posts</h2>
      <p class="text-muted-foreground">
        Check out the latest articles from our blog.
      </p>
    </div>
    {tags.map(t => <li>{t}</li>)}
    <div class="grid gap-6">
      {
        contents.map((content) => (
          <div class="grid md:grid-cols-[200px_1fr] gap-4">
            <img
              src={`https://placehold.co/400x400/999999/dddddd?font=mono&text=${content.data.title.substring(0, content.data.title.indexOf(' '))}`}
              alt="Blog post cover"
              width={200}
              height={150}
              class="rounded-lg object-cover"
              style={{ aspectRatio: "200/150", objectFit: "cover" }}
            />
            <div class="space-y-2">
              <h3 class="text-xl font-bold">{content.data.title}</h3>
              <div class="flex items-center gap-2 text-sm text-muted-foreground">
                <div>{content.data.author}</div>
                <div
                  data-orientation="vertical"
                  role="none"
                  class="shrink-0 bg-border h-full w-[1px]"
                  data-id="25"
                />
                <div>Ago 29, 2024</div>
              </div>
              <p class="text-muted-foreground line-clamp-3">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed
                euismod, nisl nec ultricies lacus, nisl nunc sollicitudin nisl,
                eget aliquam nisl nisl sit amet nisl.
              </p>
              <a
                href={'./' + content.collection + '/' + content.id.substring(3) + '/'}
                class="text-primary font-medium hover:underline"
              >
                Read more
              </a>
            </div>
          </div>
        ))
      }
    </div>
    <div class="grid gap-4">
      <div class="grid gap-2">
        <h2 class="text-2xl font-bold">Popular Posts</h2>
        <p class="text-muted-foreground">
          Check out the most popular articles from our blog.
        </p>
      </div>
      <div class="grid gap-4">
        <div class="flex items-center gap-4">
          <div
            class="flex-shrink-0 w-16 h-16 rounded-lg bg-muted/20 flex items-center justify-center text-2xl font-bold text-muted-foreground"
          >
            1
          </div>
          <div class="space-y-1">
            <h3 class="text-lg font-medium">
              Unleash Your Creativity with Figma
            </h3>
            <div class="flex items-center gap-2 text-sm text-muted-foreground">
              <div>Jane Doe</div>
              <div
                data-orientation="vertical"
                role="none"
                class="shrink-0 bg-border h-full w-[1px]"
                data-id="25"
              >
              </div>
              <div>June 1, 2023</div>
            </div>
          </div>
        </div>
        <div class="flex items-center gap-4">
          <div
            class="flex-shrink-0 w-16 h-16 rounded-lg bg-muted/20 flex items-center justify-center text-2xl font-bold text-muted-foreground"
          >
            2
          </div>
          <div class="space-y-1">
            <h3 class="text-lg font-medium">
              Mastering Responsive Design with CSS
            </h3>
            <div class="flex items-center gap-2 text-sm text-muted-foreground">
              <div>John Smith</div>
              <div
                data-orientation="vertical"
                role="none"
                class="shrink-0 bg-border h-full w-[1px]"
                data-id="25"
              >
              </div>
              <div>May 15, 2023</div>
            </div>
          </div>
        </div>
        <div class="flex items-center gap-4">
          <div
            class="flex-shrink-0 w-16 h-16 rounded-lg bg-muted/20 flex items-center justify-center text-2xl font-bold text-muted-foreground"
          >
            3
          </div>
          <div class="space-y-1">
            <h3 class="text-lg font-medium">
              Exploring the Future of JavaScript
            </h3>
            <div class="flex items-center gap-2 text-sm text-muted-foreground">
              <div>Sarah Johnson</div>
              <div
                data-orientation="vertical"
                role="none"
                class="shrink-0 bg-border h-full w-[1px]"
                data-id="25"
              >
              </div>
              <div>April 30, 2023</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div></BaseLayout
>
